<!-- htmlhint spec-char-escape:false -->
<!--
This is the 'listings' view. It loops through all listings passed to it and prints all of them in a list.
The listings link to their respective '/box/:id' pages.

The list can be filtered using the 'search-filters' partial. It includes javascript to animate the filtering
-->

<!DOCTYPE html>

<html>

<head>

  <%- include( 'partials/head' ); %>
  <style>

  </style>

</head>

<body>

	<%- include( 'partials/nav' ); %>

	<div class="content">

		<ul class="listings">

      <% listings.forEach( function( listing, i ) { %>
        <li id="<%= listing._id %>">
          <h3>File name: <%= listing.name %></h3>
          <p>Language: <%- listing.language %><p>
          <p>Translated: <%- listing.translated %><p>
          <% if(!listing.translated){ %>
          <div>
            <input type='button' class='btn_translate' value='Translate'>
          </div>
          <% } %>
        </li>

      <% }) %>

		</ul>

	</div>
  <script>
  $( document ).ready(function() {

    $(".btn_translate").on('click', function(){
      // disable all the translate button
      $('.btn_translate').attr('disabled',true);
      // show progress gif
      $('.listings').prepend('<div id="loading_bar" ><img src="/images/loadingfinal.gif"/></div>');

      var id = $(this).closest("li").prop("id");
      console.log(id);
      //
      $.post("/translate",{id: id}, function(data, status){
          $('#loading_bar').remove();
          $('.btn_translate').attr('disabled', false);

          // TODO refresh listings page
          // console.log("Data: " + data + "\nStatus: " + status);
        });
    });

  });
  </script>
  <%- include( 'partials/footer' ); %>

</body>

</html>
