<!DOCTYPE HTML>

<html>

<head>

  <%- include( 'partials/head' ); %>

  <style>
    .text_edit {
      width: 500px;
      height: 300px;
      resize: none;
    }
  </style>
</head>

<body>
  <br />
  <h1 style="margin: 0;">Audio Transcription Editing Tool</h1>
  <p id="blockquote" class="blockquote" ><%= data.audio %></p>

  <div class="clearfix">
    <Audio id="audio" controls="true" src="/<%= data.audio %>" style="width: 80%; margin-left: auto; margin-right: auto; margin-bottom: 30px;" />
  </div>

  <!-- Text area -->
  <textarea class="text_edit" id="my_text"><%= data.subtitle %></textarea>
  <br />

  <input type="button" id="dwn-btn" value="Download as text file"/>
  <input type="button" id="save-btn" value="Save" onclick="save('<%= data._id %>')"/>

  <script type="text/javascript">
    function download(filename, text) {
      var element = document.createElement('a');
      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
      element.setAttribute('download', filename);

      element.style.display = 'none';
      document.body.appendChild(element);

      element.click();

      document.body.removeChild(element);
    }

    // Start file download.
    document.getElementById("dwn-btn").addEventListener("click", function() {
      var text = document.getElementById("my_text").value;
      var filename = document.getElementById("blockquote").innerHTML+'.txt';

      download(filename, text);
    }, false);

    function save(id) {
      var text = document.getElementById("my_text").value;
      $.ajax({
        url: '/subtitle/save/'+ id,
        type: 'POST',
        timeout: 0,
        data: {content: text},
        success: function(response, status){
            //location.reload(true);
            console.log("Data: " + response + "\nStatus: " + status);
          },
        error: function(request,error) {
              console.log(request.responseText);
              console.log(error);
          }
      });
    }

  </script>
</body>

</html>
